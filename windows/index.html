<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Historic Gym Windows | RORC</title>
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
  <div class="site-menu">
    <input type="checkbox" id="site-menu-toggle" class="site-menu-toggle" />
    <div class="site-menu-bar">
      <a class="site-menu-brand" href="/">RORC</a>
      <label class="site-menu-button" for="site-menu-toggle">Menu</label>
    </div>
    <label class="site-menu-backdrop" for="site-menu-toggle" aria-hidden="true"></label>
    <div class="site-menu-panel" role="dialog" aria-label="Site menu">
      <label class="site-menu-close" for="site-menu-toggle">Close</label>
      <div>
        <nav class="site-menu-links" aria-label="Site">
          <a href="/">Home</a>
          <a href="/about-rorc/">About</a>
          <a href="/memberships/">Memberships</a>
          <a href="/rentals/">Rentals</a>
          <a href="/sponsors/">Sponsors</a>
          <a href="/application/">Application</a>
        </nav>
      </div>
      <div class="site-menu-legal" aria-label="Legal">
        <a href="/support/">Support</a>
        <a href="/privacy-policy/">Privacy Policy</a>
        <a href="/terms-of-service/">Terms of Service</a>
      </div>
    </div>
  </div>

  <main class="page-content">
    <div class="about-return">
      <a class="about-return-link" href="/">Return to RORC home</a>
    </div>

    <section class="windows-hero">
      <div class="windows-kicker">Historic Gym Windows Fundraiser</div>
      <h1>Historic Gym Windows</h1>
      <p class="windows-lead">
        When the original windows were removed during recent upgrades, we chose not to discard them. These were the
        first windows installed in the Ruth Obenchain Recreation Center, looking out over decades of open gym nights,
        community gatherings, school events, and everyday life in Bly.
      </p>
      <p class="windows-lead">
        We’re making them available to the community before anything else.
      </p>
      <div class="windows-stats">
        <div class="windows-stat">
          <span class="windows-stat-label">Per window</span>
          <span class="windows-stat-value">$25</span>
        </div>
        <div class="windows-stat">
          <span class="windows-stat-label">Available</span>
          <span class="windows-stat-value" id="windowAvailableHero">32</span>
        </div>
        <div class="windows-stat">
          <span class="windows-stat-label">Pickup</span>
          <span class="windows-stat-value">Local only</span>
        </div>
      </div>
    </section>

    <section class="windows-details">
      <h2>The Details</h2>
      <div class="windows-details-grid">
        <div class="windows-detail">Sold individually</div>
        <div class="windows-detail">Windows vary in condition</div>
        <div class="windows-detail">Some original panes are available for restoration</div>
        <div class="windows-detail">Local pickup only</div>
      </div>
      <p class="windows-note">Windows are reserved only after online payment is completed.</p>
    </section>

    <section class="windows-why windows-why-center">
      <h2>Why We’re Doing This</h2>
      <p>Every dollar raised goes directly back into maintaining and improving the facility.</p>
      <p>This building has lasted because the community continues to invest in it.</p>
      <p>
        If you’ve ever used this gym, brought your kids here, attended an event, or simply want to own a physical piece
        of its story — this is an opportunity to do that.
      </p>
    </section>

    <section class="windows-purchase">
      <div class="windows-purchase-card">
        <h2>Purchase</h2>
        <p>After purchase, we will contact you to coordinate pickup.</p>
        <button id="buyWindowBtn" class="rorc-btn rorc-btn-accent" type="button">
          Purchase a Window
        </button>
        <p id="buyWindowMsg" class="windows-purchase-msg"></p>
        <div id="windowStockWrap" class="windows-purchase-stock">
          <div id="windowRemaining" class="windows-purchase-remaining"></div>
          <div id="windowUrgency" class="windows-purchase-urgency"></div>
        </div>
      </div>

      <script>
        const WINDOWS_SCRIPT_URL =
          "https://script.google.com/macros/s/AKfycby7j1VbmMkmZI8gp4AFHSAhuuGbLRVma-2ftKn6XlM62j_zy_VVhQ8qqprykO805s8W/exec";

        function formatCountdown(ms) {
          const s = Math.max(0, Math.floor(ms / 1000));
          const m = Math.floor(s / 60);
          const r = s % 60;
          return `${m}:${String(r).padStart(2, "0")}`;
        }

        function setUrgency(remaining) {
          const el = document.getElementById("windowUrgency");
          if (!el) return;

          // simple, calm “urgency” tiers
          if (remaining <= 0) {
            el.textContent = "Sold out.";
            return;
          }
          if (remaining <= 3) {
            el.textContent = "Almost gone.";
            return;
          }
          if (remaining <= 10) {
            el.textContent = "Limited quantity remaining.";
            return;
          }
          el.textContent = "Available while supplies last.";
        }

        function updateRemainingUI(remaining) {
          const remainingEl = document.getElementById("windowRemaining");
          const btn = document.getElementById("buyWindowBtn");
          const heroCount = document.getElementById("windowAvailableHero");

          if (remainingEl) {
            remainingEl.innerHTML = `<strong>${remaining}</strong> window${remaining === 1 ? "" : "s"} remaining.`;
          }
          if (heroCount) {
            heroCount.textContent = Number.isFinite(remaining) ? String(remaining) : "–";
          }

          setUrgency(remaining);

          // Auto-disable at 0
          if (btn) {
            const soldOut = !Number.isFinite(remaining) || remaining <= 0;
            btn.disabled = soldOut;
            if (soldOut) btn.textContent = "Sold Out";
          }
        }

        function fetchRemainingJsonp() {
          const cb = "windowsStatusCb_" + Date.now();

          window[cb] = function (data) {
            try {
              if (data && data.ok) {
                const remaining = Number(data.remaining ?? 0);
                updateRemainingUI(remaining);
              }
            } finally {
              delete window[cb];
              script.remove();
            }
          };

          const script = document.createElement("script");
          script.src = `${WINDOWS_SCRIPT_URL}?action=status&callback=${cb}`;
          script.onerror = () => {
            // If status fails, don’t break checkout — just hide the counter.
            const wrap = document.getElementById("windowStockWrap");
            if (wrap) wrap.style.display = "none";
            delete window[cb];
            script.remove();
          };
          document.body.appendChild(script);
        }

        // Checkout button (JSONP)
        document.getElementById("buyWindowBtn").addEventListener("click", () => {
          const msg = document.getElementById("buyWindowMsg");
          msg.textContent = "Starting checkout...";

          const cb = "windowsCheckoutCb_" + Date.now();

          window[cb] = function (data) {
            try {
              if (data && data.ok && data.checkoutUrl) {
                window.location.href = data.checkoutUrl;
                return;
              }
              if (data && data.code === "SOLD_OUT") {
                msg.textContent = "Sold out.";
                document.getElementById("buyWindowBtn").disabled = true;
                return;
              }
              msg.textContent = "Could not start checkout. Please try again.";
            } finally {
              delete window[cb];
              script.remove();
            }
          };

          const script = document.createElement("script");
          script.src = `${WINDOWS_SCRIPT_URL}?action=startCheckout&callback=${cb}`;
          script.onerror = () => {
            msg.textContent = "Could not start checkout. Please try again.";
            delete window[cb];
            script.remove();
          };

          document.body.appendChild(script);
        });

        // Optional: success/canceled messages
        (function () {
          const params = new URLSearchParams(window.location.search);
          const msg = document.getElementById("buyWindowMsg");
          if (!msg) return;

          if (params.get("success") === "1") {
            msg.textContent = "Payment received. Thank you. We will contact you to coordinate pickup.";
          } else if (params.get("canceled") === "1") {
            msg.textContent = "Checkout canceled. No payment was taken.";
          }
        })();

        // Countdown “urgency” styling: refresh count every 60 seconds,
        // and show a small countdown until the next refresh.
        (function startStockRefresh() {
          const urgencyEl = document.getElementById("windowUrgency");
          const refreshEveryMs = 60000;
          let nextRefreshAt = Date.now() + refreshEveryMs;

          fetchRemainingJsonp();

          setInterval(() => {
            const now = Date.now();
            const msLeft = nextRefreshAt - now;

            // show countdown only if quantity is getting low (<= 10)
            const remainingText = document.getElementById("windowRemaining")?.textContent || "";
            const match = remainingText.match(/\\d+/);
            const remaining = match ? Number(match[0]) : 999;

            if (urgencyEl && remaining <= 10 && remaining > 0) {
              urgencyEl.textContent = `Limited quantity. Refreshing stock in ${formatCountdown(msLeft)}.`;
            }

            if (msLeft <= 0) {
              nextRefreshAt = Date.now() + refreshEveryMs;
              fetchRemainingJsonp();
            }
          }, 1000);
        })();
      </script>
    </section>
  </main>

  <footer class="site-footer">
    <div class="site-footer-inner">
      <div>© 2026 Ruth Obenchain Recreation Center</div>
      <div class="site-footer-links">
        <a href="/support/">Support</a>
        <a href="/privacy-policy/">Privacy Policy</a>
        <a href="/terms-of-service/">Terms of Service</a>
      </div>
      <div>Operated by Bly Community Action Team</div>
    </div>
  </footer>
</body>
</html>
